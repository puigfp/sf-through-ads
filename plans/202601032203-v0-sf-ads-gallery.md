# V0 Plan: SF Through Ads - Static Image Gallery

## Overview

A static Instagram-like website showcasing unique advertisements from San Francisco. Built with Next.js + React + Tailwind CSS, deployed on Vercel, with images managed via a YAML manifest.

---

## Technical Stack

### Framework: **Next.js 15 (App Router) + Tailwind CSS v4**

- **Next.js 15** - React framework with built-in image optimization, file-based routing, and excellent Vercel integration
- **React 19** - Latest stable React with concurrent features
- **TypeScript 5.7** - Type safety
- **Tailwind CSS v4** - Latest utility-first styling

### Image Strategy

**Two image types stored together in `public/images/`:**

1. **Full Images** (original aspect ratio, full resolution)
   - Filename: `001.jpg`
   - HEIC converted to JPEG during import, NOT cropped
   - Next.js `<Image>` component handles on-demand optimization
   - Used in slideshow (original aspect ratio)

2. **Thumbnails** (1:1 cropped, full resolution)
   - Filename: `001_thumbnail.jpg` (same base name + `_thumbnail` suffix)
   - Pre-generated during import using AI-determined crop region
   - Full resolution crop (not resized) - Next.js handles sizing optimization
   - Used in grid view

**Why this approach:**
- Thumbnails need AI cropping (can't be done at runtime)
- Both images stored together for simpler organization
- Next.js/Vercel handles all resizing optimization at serve time
- Full resolution source = best quality at any size

### Supported Image Formats

- **HEIC** (primary) - native iPhone format, converted to JPEG on import
- **JPEG/JPG** - copied directly

---

### Tool Management with mise

Use [mise](https://mise.jdx.dev) to manage Node.js version and ensure consistent tooling:

```toml
# mise.toml
[tools]
node = "22"
pnpm = "9"

[env]
NODE_ENV = "development"
```

---

## Project Structure

```
sf-through-ads/
├── public/
│   └── images/              # All processed images
│       ├── 001.jpg          # Full image (original aspect ratio)
│       ├── 001_thumbnail.jpg # Thumbnail (1:1 cropped)
│       ├── 002.jpg
│       ├── 002_thumbnail.jpg
│       └── ...
├── src/
│   ├── app/
│   │   ├── layout.tsx           # Root layout with metadata
│   │   ├── page.tsx             # Home page (grid view)
│   │   ├── image/
│   │   │   └── [id]/
│   │   │       └── page.tsx     # Image permalink (slideshow)
│   │   ├── feed.xml/
│   │   │   └── route.ts         # RSS feed endpoint
│   │   └── globals.css          # Tailwind imports
│   ├── components/
│   │   ├── ImageGrid.tsx        # Grid with infinite scroll
│   │   ├── ImageCard.tsx        # Single image in grid
│   │   ├── Slideshow.tsx        # Modal slideshow viewer
│   │   └── Header.tsx           # Site header
│   ├── hooks/
│   │   └── useInfiniteScroll.ts
│   ├── lib/
│   │   ├── images.ts            # Load and parse image data
│   │   └── config.ts            # Site constants
│   └── data/
│       └── images.yaml          # Image manifest
├── scripts/
│   └── import-images.ts         # Import script
├── originals/                   # Original iPhone files (kept in repo)
├── plans/
├── package.json
├── pnpm-lock.yaml
├── mise.toml                    # Tool versions (Node.js)
├── next.config.ts
├── tailwind.config.ts
├── tsconfig.json
├── .env                         # Encrypted secrets (committed)
├── .env.keys                    # Decryption keys (gitignored, NEVER commit)
└── .gitignore
```

---

## Site Configuration (src/lib/config.ts)

All site-wide constants defined here and imported throughout the app:

```typescript
export const SITE_CONFIG = {
  name: "SF Through Ads",
  description: "A visual collection of unique advertisements from San Francisco",
  url: "https://sf-through-ads.vercel.app", // Update when custom domain is set
  author: "Francisco",
  
  // UI settings
  gridBatchSize: 20,
  gridThumbnailSize: 400, // Display size for grid thumbnails (Next.js will optimize)
} as const;
```

This constant is used for:
- Page `<title>` and metadata
- Open Graph meta tags
- RSS feed metadata
- Any UI text referencing the site name

---

## Image Manifest Schema (src/data/images.yaml)

```yaml
images:
  - id: 1
    filename: "001.jpg"                    # Full image filename
    thumbnail_filename: "001_thumbnail.jpg" # Thumbnail filename (1:1 cropped)
    original_path: "IMG_1234.HEIC"         # Original iPhone filename
    original_hash: "sha256:abc123..."      # SHA-256 of original file for deduplication
    taken_at: "2025-12-15T14:32:00-08:00"  # ISO 8601 with timezone
    width: 4032                            # Original image width
    height: 3024                           # Original image height
    location:
      lat: 37.7749
      lng: -122.4194
    ai_generated_alt_text: "A vintage neon sign advertising fresh donuts on a Mission District corner."
    description: ""                        # YOUR sarcastic comment goes here (optional)
    ai_generated_crop:                     # Auto-generated crop region (already applied to thumbnail)
      x: 605                               # X offset in pixels from left
      y: 302                               # Y offset in pixels from top
      size: 2822                           # Crop size in pixels (square)
    tags: []                               # Reserved for future use

  - id: 2
    filename: "002.jpg"
    thumbnail_filename: "002_thumbnail.jpg"
    # ...
```

**Key fields:**
- `filename` - Full image (original aspect ratio)
- `thumbnail_filename` - 1:1 cropped version for grid
- `width` / `height` - Original dimensions (for aspect ratio calculations)
- `ai_generated_alt_text` - Auto-generated by import script - used for img alt attribute
- `description` - **YOU FILL THIS IN** - your sarcastic comment (optional, shown in slideshow + RSS)
- `ai_generated_crop` - Auto-generated crop region (stored for reference, already applied to thumbnail)

---

## Import Script Behavior

```bash
pnpm import-images <source-folder>
```

### Process for each image:

1. **Scan** source folder for image files (`.heic`, `.HEIC`, `.jpg`, `.jpeg`, `.JPG`, `.JPEG`)
2. **Hash check** - Compute SHA-256 hash, skip if already in `images.yaml`
3. **Extract EXIF** - Get date/time, GPS coordinates, and dimensions using `exifr`
   - **Fallback:** If EXIF date is missing, use file modification time
4. **AI Analysis** (OpenAI Vision API):
   - Send image to GPT-4o vision
   - Get optimal 1:1 crop region (returned as x, y, size in pixels)
   - Get 1-2 sentence alt text describing the advertisement
5. **Generate ID** - Auto-increment from highest existing ID, zero-padded (e.g., `001`, `002`)
6. **Process image with Sharp:**
   - Convert HEIC to JPEG (full resolution, original aspect ratio) → save as `public/images/{id}.jpg`
   - Apply AI-determined 1:1 crop (full resolution, no resize) → save as `public/images/{id}_thumbnail.jpg`
7. **Archive original** - Copy to `originals/` folder (kept in repo for backup)
8. **Update manifest** - Append entry to `images.yaml` with:
   - Both filenames, dimensions, EXIF data
   - `ai_generated_alt_text`
   - `description` (empty string, for manual editing later)
9. **Sort manifest** - Sort by `taken_at` descending (most recent first)

### Secret Management with dotenvx

Use [dotenvx](https://dotenvx.com) for encrypted secret management. This allows the `.env` file to be safely committed to git (encrypted), while keeping decryption keys separate.

**Setup:**
```bash
# Install dotenvx
pnpm add -D @dotenvx/dotenvx

# Create encrypted .env file
pnpm dotenvx set OPENAI_API_KEY "sk-..."
```

This creates:
- `.env` - Encrypted secrets file (safe to commit)
- `.env.keys` - Decryption keys (**NEVER commit this**)

**Running the import script:**
```bash
pnpm import-images <source-folder>
```

The import script in package.json uses dotenvx:
```json
{
  "scripts": {
    "import-images": "dotenvx run -- tsx scripts/import-images.ts"
  }
}
```

### Dependencies for script:
- `sharp` - HEIC→JPEG conversion and 1:1 crop extraction
- `exifr` - EXIF data extraction (handles HEIC natively)
- `yaml` - YAML parsing/writing
- `openai` - OpenAI API client

### Error Handling:
- If AI API fails, fall back to center crop
- If EXIF date is missing, use file modification time (log warning)
- If GPS coordinates are missing, set `location` to `null`
- Log all skipped/failed imports with reasons

---

## UI/UX Specifications

### Color Scheme

- **Grid View:** Light background for clean image presentation
- **Slideshow:** Dark overlay (`bg-black/90`) for cinematic, focused viewing

### Grid View (Home Page - `/`)

- **Layout:** Instagram-style grid, 1:1 square thumbnails
- **Columns:** 2 on mobile (<640px), 3 on tablet (640-1024px), 4 on desktop (>1024px)
- **Background:** Light (white or very light gray)
- **Infinite scroll:** Load ~20 images at a time using Intersection Observer
- **Animations:** Smooth fade-in as images enter viewport
- **Sort order:** By `taken_at` descending (newest first)
- **No date overlay** - clean grid, date shown only in slideshow

### Slideshow Modal

- **Trigger:** Click any image in grid, or navigate directly to `/image/:id`
- **Layout:** Full-screen dark overlay with centered image (original aspect ratio)
- **Image sizing:** Fit within viewport while preserving aspect ratio (`object-contain`)
- **Navigation:**
  - Left/right arrow buttons (semi-transparent, visible on hover)
  - Keyboard: ← → arrows, Escape to close
  - Mobile: Swipe gestures (left/right)
  - Click outside image to close
- **Close button:** X in top-right corner of viewport

#### Film-Style Date Display

Date and time displayed in bottom-right corner of the image, styled like a film camera date stamp:

```
'25 DEC 15  14:32
```

- **Font:** Monospace (`font-mono`)
- **Color:** Orange/amber (`#FF6B00`)
- **Style:** Slightly transparent, with subtle text shadow for readability
- **Position:** Bottom-right corner, inside the image bounds
- **Format:** `'YY MMM DD  HH:mm` (year abbreviated with apostrophe, uppercase month)

#### Description Display

- Manual description (sarcastic comment) shown below the image if provided
- If no manual description, show nothing (ai_generated_alt_text is only for accessibility)
- Light gray text on dark background
- Centered, max-width for readability
- Subtle fade-in animation

### Permalinks

- **Route:** `/image/:id`
- **Behavior:** Opens slideshow view with that image
- **Navigation:** URL updates when navigating between images

### Social Sharing (Open Graph)

Each image page includes meta tags via Next.js Metadata API:

```typescript
export async function generateMetadata({ params }): Promise<Metadata> {
  const image = getImageById(params.id);
  // Use manual description if provided, otherwise fall back to ai_generated_alt_text
  const desc = image.description || image.ai_generated_alt_text;
  return {
    title: `${SITE_CONFIG.name}`,
    description: desc,
    openGraph: {
      title: SITE_CONFIG.name,
      description: desc,
      images: [`/images/${image.filename}`],
      url: `${SITE_CONFIG.url}/image/${image.id}`,
    },
    twitter: {
      card: "summary_large_image",
    },
  };
}
```

### Responsive Design

- Mobile-first Tailwind classes
- Grid: `grid-cols-2 sm:grid-cols-3 lg:grid-cols-4`
- Touch-optimized slideshow controls
- Proper viewport meta tag
- No horizontal scroll

---

## RSS Feed

### Endpoint: `/feed.xml`

Implemented as a Next.js Route Handler that generates RSS 2.0 XML:

```typescript
// src/app/feed.xml/route.ts
import { SITE_CONFIG } from "@/lib/config";
import { getAllImages } from "@/lib/images";

function formatRssTitle(date: Date): string {
  // Format: "Dec 15, 2025 at 2:32 PM"
  return date.toLocaleDateString("en-US", {
    month: "short",
    day: "numeric", 
    year: "numeric",
  }) + " at " + date.toLocaleTimeString("en-US", {
    hour: "numeric",
    minute: "2-digit",
  });
}

export async function GET() {
  const images = await getAllImages();
  
  const rss = `<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>${SITE_CONFIG.name}</title>
    <link>${SITE_CONFIG.url}</link>
    <description>A culture shock story told using pictures of ads</description>
    <atom:link href="${SITE_CONFIG.url}/feed.xml" rel="self" type="application/rss+xml"/>
    ${images.map(img => `
    <item>
      <title>${formatRssTitle(new Date(img.taken_at))}</title>
      <link>${SITE_CONFIG.url}/image/${img.id}</link>
      <description><![CDATA[<img src="${SITE_CONFIG.url}/images/${img.filename}" />${img.description ? `<p>${img.description}</p>` : ""}]]></description>
      <pubDate>${new Date(img.taken_at).toUTCString()}</pubDate>
      <guid isPermaLink="true">${SITE_CONFIG.url}/image/${img.id}</guid>
    </item>`).join("")}
  </channel>
</rss>`;

  return new Response(rss, {
    headers: {
      "Content-Type": "application/xml",
      "Cache-Control": "public, max-age=3600",
    },
  });
}
```

### RSS Features:
- **Entry title:** Datetime of the picture (e.g., "Dec 15, 2025 at 2:32 PM")
- Full image embedded in description
- Manual description (sarcastic comment) shown if provided
- Publication date from `taken_at`
- Permalink as GUID
- Auto-discovery link in HTML `<head>`

---

## Vercel Deployment

### Configuration (next.config.ts)

```typescript
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  // Enable static image optimization on Vercel
  images: {
    formats: ["image/avif", "image/webp"],
  },
};

export default nextConfig;
```

No `vercel.json` needed - Next.js is auto-detected.

### Preview Deployments

Vercel automatically creates preview deployments for every PR when the GitHub repo is connected:
1. Push repo to GitHub
2. Connect repo to Vercel via dashboard
3. Every PR gets a unique preview URL

### Initial Deployment

- v0 deployed to `sf-through-ads.vercel.app` (or similar auto-generated subdomain)
- Custom domain added later via Vercel dashboard

---

## Dependencies (package.json)

Use latest stable versions as of January 2026:

### Dependencies
```json
{
  "next": "^15.1.0",
  "react": "^19.0.0",
  "react-dom": "^19.0.0"
}
```

### Dev Dependencies
```json
{
  "@dotenvx/dotenvx": "^1.34.0",
  "@tailwindcss/postcss": "^4.0.0",
  "@types/node": "^22.10.0",
  "@types/react": "^19.0.0",
  "@types/react-dom": "^19.0.0",
  "exifr": "^7.1.0",
  "openai": "^4.77.0",
  "sharp": "^0.33.0",
  "tailwindcss": "^4.0.0",
  "tsx": "^4.19.0",
  "typescript": "^5.7.0",
  "yaml": "^2.6.0"
}
```

---

## Implementation Steps

### Phase 1: Project Setup
1. Create `mise.toml` for tool versioning:
   ```toml
   [tools]
   node = "22"
   pnpm = "9"
   ```
2. Run `mise install` to install Node.js and pnpm
3. Create Next.js project: `pnpm create next-app@latest . --typescript --tailwind --app --src-dir`
4. Verify dependencies are latest stable versions
5. Set up folder structure:
   - `public/images/`
   - `originals/`
   - `src/data/`
   - `scripts/`
6. Create `.gitignore`:
   ```
   node_modules/
   .next/
   .env.keys
   ```
7. Set up dotenvx for secret management:
   ```bash
   pnpm add -D @dotenvx/dotenvx
   pnpm dotenvx set OPENAI_API_KEY "sk-..."
   ```
   This creates `.env` (encrypted, committed) and `.env.keys` (gitignored)
8. Create `src/lib/config.ts` with site constants
9. Create empty `src/data/images.yaml`
10. Push to GitHub and connect to Vercel

### Phase 2: Import Script
1. Install script dependencies: `pnpm add -D sharp exifr yaml openai tsx`
2. Create `scripts/import-images.ts`:
   - File scanning (HEIC + JPEG)
   - SHA-256 hashing for deduplication
   - EXIF extraction (date, GPS, dimensions)
   - OpenAI Vision API integration (crop + description)
   - Image processing:
     - Full image: HEIC → JPEG conversion (full resolution) → `{id}.jpg`
     - Thumbnail: Apply AI 1:1 crop (full resolution) → `{id}_thumbnail.jpg`
   - YAML read/write/sort with both filenames
3. Add to package.json: `"import-images": "dotenvx run -- tsx scripts/import-images.ts"`
4. Test with sample images

### Phase 3: Data Layer
1. Create `src/lib/images.ts`:
   - `getAllImages()` - returns sorted array
   - `getImageById(id)` - returns single image or null
   - Parse YAML at build time
2. Type definitions for Image interface

### Phase 4: Core UI - Grid
1. Create `src/components/Header.tsx` with site name
2. Create `src/components/ImageCard.tsx`:
   - Uses Next.js `<Image>` with `thumbnail_filename`
   - Lazy loading built-in
   - Click handler to open slideshow
3. Create `src/components/ImageGrid.tsx`:
   - Responsive grid layout
   - Infinite scroll with `useInfiniteScroll` hook
4. Update `src/app/page.tsx` to render grid
5. Style with Tailwind:
   - Light background
   - Responsive columns
   - Fade-in animations

### Phase 5: Slideshow
1. Create `src/components/Slideshow.tsx`:
   - Full-screen dark overlay
   - Display image with original aspect ratio (use `ai_generated_alt_text` for img alt attribute)
   - Film-style date stamp overlay
   - Manual description below image (if provided)
2. Implement navigation:
   - Previous/next buttons
   - Keyboard handlers (←, →, Escape)
   - Touch swipe gestures
3. Create `src/app/image/[id]/page.tsx`:
   - Load image by ID
   - Render Slideshow component
   - Generate metadata for OG tags

### Phase 6: RSS Feed
1. Create `src/app/feed.xml/route.ts`
2. Implement RSS 2.0 generation
3. Add auto-discovery link in root layout:
   ```html
   <link rel="alternate" type="application/rss+xml" href="/feed.xml" title="SF Through Ads" />
   ```
4. Test with RSS reader

### Phase 7: Polish & Testing
1. Loading states (skeleton grid with `animate-pulse`)
2. Error handling (missing images, 404 for invalid IDs)
3. Test on mobile devices
4. Test keyboard navigation
5. Test social sharing (Facebook/Twitter debuggers)
6. Accessibility:
   - Alt text from `ai_generated_alt_text` field
   - Focus management in modal
   - ARIA labels
7. Lighthouse performance check

---

## Design Decisions Summary

| Decision | Choice |
|----------|--------|
| Package manager | pnpm |
| Tool versioning | mise (Node.js 22, pnpm 9) |
| Framework | Next.js 15 (App Router) |
| CSS Framework | Tailwind CSS v4 |
| Image optimization | Next.js Image (all resizing at serve time) |
| Image storage | `public/images/` with `_thumbnail` suffix |
| Grid images | 1:1 square (AI smart crop, full resolution) |
| Slideshow images | Original aspect ratio (uncropped, full resolution) |
| Color scheme | Light grid, dark slideshow |
| Location display | Stored only, not shown in v0 |
| Date display | Slideshow only, film camera style |
| RSS entry titles | Datetime of the picture |
| ai_generated_alt_text | Auto-generated by import (for accessibility) |
| description | Manual field for sarcastic comments (shown in slideshow + RSS) |
| Original files | Kept in repo (not gitignored) |
| Image formats | HEIC primary, JPEG supported |
| Tags | Field present, unused in v0 |
| RSS feed | Included in v0 |
| Domain | Vercel subdomain for v0 |
| Social sharing | Open Graph meta tags included |
| Missing EXIF date | Use file modification time as fallback |
| Secret management | dotenvx (encrypted .env, gitignored .env.keys) |
| Site name | Constant in config, reused everywhere |

---

## Future Enhancements (Post-V0)

- Map view showing image locations (using stored GPS)
- Filter by neighborhood / tags
- Search by date range
- Manual description editing/override
- Analytics (privacy-respecting)
- Custom domain setup
- Dark mode toggle for grid view

---

## Cost Considerations

**OpenAI API (per image import):**
- GPT-4o with vision: ~$0.01-0.03 per image (crop + description)
- For 1000 images: ~$10-30 total
- One-time cost at import time, not per page view

---

## Files to Create

1. `mise.toml` - Tool versions (Node.js 22, pnpm 9)
2. `package.json` - dependencies and scripts
3. `pnpm-lock.yaml` - lockfile (auto-generated)
4. `next.config.ts` - Next.js configuration
5. `tailwind.config.ts` - Tailwind v4 configuration
6. `tsconfig.json` - TypeScript configuration
7. `.gitignore` - ignore .env.keys, .next, node_modules
8. `.env` - Encrypted secrets via dotenvx (committed)
9. `.env.keys` - Decryption keys (NOT committed, gitignored)
10. `src/lib/config.ts` - site constants
11. `src/lib/images.ts` - image data utilities
12. `src/data/images.yaml` - empty manifest
13. `scripts/import-images.ts` - import script
14. `src/app/layout.tsx` - root layout with metadata
15. `src/app/page.tsx` - home page (grid)
16. `src/app/globals.css` - Tailwind imports
17. `src/app/image/[id]/page.tsx` - image permalink
18. `src/app/feed.xml/route.ts` - RSS feed
19. `src/components/Header.tsx`
20. `src/components/ImageGrid.tsx`
21. `src/components/ImageCard.tsx`
22. `src/components/Slideshow.tsx`
23. `src/hooks/useInfiniteScroll.ts`

---

## Implementation Notes

Issues encountered during implementation and solutions applied:

### 1. HEIC Processing Failure
**Issue:** Sharp's built-in HEIC support via libheif failed with "No decoding plugin installed for this compression format" even after installing libheif via Homebrew.

**Solution:** Used macOS native `sips` command for HEIC→JPEG conversion instead of Sharp. This is more reliable on macOS since sips has full native HEIC support.

### 2. EXIF Extraction from HEIC
**Issue:** The `exifr` library couldn't parse HEIC files directly, returning "Unknown file format" errors.

**Solution:** Used macOS `mdls` command to extract EXIF metadata (date, GPS) from original HEIC files, with exifr on the converted JPEG as fallback.

### 3. AI Crop Centering
**Issue:** When asking GPT-4o to calculate crop coordinates directly, the AI performed poorly at the math, resulting in off-center crops.

**Solution:** Split into two-step approach:
1. Ask AI only for the bounding box of the advertisement (left, top, right, bottom)
2. Calculate center and crop position programmatically from the bounding box

### 4. Server-Only Module Imports
**Issue:** The `images.ts` module used Node.js `fs` module, which caused build failures when client components tried to import it.

**Solution:** 
- Added `import "server-only"` to `images.ts`
- Moved shared types to `types.ts` (client-safe)
- Moved `formatFilmDate` utility to `utils.ts` (client-safe)

### 5. Image Grid Not Displaying
**Issue:** Images showed as 0x0 pixels in the grid.

**Solution:** Added `block` class to the `<Link>` component in ImageCard. The `aspect-square` utility only works on block-level elements.

### 6. Film Date Stamp Position
**Issue:** The film-style date stamp was positioned outside the actual image bounds due to `object-contain` letterboxing.

**Solution:** Used the image's actual aspect ratio from metadata to size the container, ensuring the date stamp stays within image bounds.

### 7. Stale Image Cache
**Issue:** After re-importing images, the dev server showed old cached thumbnails.

**Solution:** Delete `.next` folder and restart dev server to clear Next.js image optimization cache.

### 8. Film Date Text Wrapping
**Issue:** The film-style date stamp was wrapping to multiple lines (each part on a separate line) instead of staying on one line.

**Solution:** Added `whitespace-nowrap` class to prevent text wrapping.

### 9. Film Date Format Extended
**Issue:** User requested format change to include GPS coordinates.

**Solution:** Updated `formatFilmDate` function to accept optional location parameter and display format: `2026 01 03 14:32 37.77°N 122.41°W`

### 10. Film Date Contrast Issues
**Issue:** Orange text on varying image backgrounds had poor contrast in some cases. Added dark background but it was too prominent.

**Solution:** Made the date stamp more subtle: smaller text (10px mobile, 12px desktop), 70% opacity orange color, no background, positioned closer to corner.

### 11. AI Crop 75% Requirement Failed
**Issue:** When asking AI to directly calculate a crop where the ad takes 75% of the frame, the results were poor (crops too small/wrong).

**Solution:** Reverted to bounding box approach - AI identifies ad edges, we calculate centered crop programmatically using full available height. The 75% direct instruction to the AI didn't work well.

### 12. Slideshow Image Disappearing
**Issue:** After modifying the image container to use aspect ratio for positioning, the image disappeared because the container had no defined dimensions.

**Solution:** Added `w-full h-full` to outer container and `h-full` to inner container so aspect-ratio can calculate width from height.

### 13. AI Cropping Abandoned
**Issue:** Despite multiple attempts with different prompts (bounding box, center point, direct crop coordinates, 75% requirement), AI-powered cropping consistently produced unreliable results - sometimes cropping to sky, cutting off ad text, or producing poorly centered results.

**Solution:** Abandoned AI cropping entirely. Implemented simple center crop: take the shorter dimension as the square size, crop from center. This is predictable and works well for most photos where the ad is roughly centered.

### 14. Full Images + Thumbnails
**Issue:** Initially removed thumbnails, but slideshow needs full aspect ratio while grid needs square crops.

**Solution:** Keep both:
- `001.jpg` - Full image (original aspect ratio) for slideshow
- `001_thumb.jpg` - Square center-cropped thumbnail for grid
This provides the best UX: square grid for browsing, full images for viewing.

### 15. OpenAI Structured Outputs
**Issue:** JSON parsing from AI responses was fragile - no guarantee the response matched expected schema.

**Solution:** Used OpenAI's Structured Outputs feature with `response_format: { type: "json_schema", json_schema: { strict: true, ... } }` for type-safe, validated responses.

### 16. Alt Text Caching
**Issue:** Re-importing images called OpenAI API every time, wasting money and time.

**Solution:** Added disk-based caching for alt text in `.cache/alt-text/` (gitignored). Cache is keyed by image hash, so:
- Re-imports of same images skip API calls
- Changed images get fresh alt text
- Cache persists across sessions

### 17. 5-Digit ID Padding
**Issue:** Original 3-digit padding (`001.jpg`) only supported 999 images.

**Solution:** Changed to 5-digit padding (`00001.jpg`) to support up to 99,999 images.

### Additional Files Created
- `src/lib/types.ts` - Client-safe type definitions
- `src/lib/utils.ts` - Client-safe utility functions (formatFilmDate with GPS support)
- `.cache/alt-text/` - Alt text cache directory (gitignored)
